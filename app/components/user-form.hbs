<form
  {{on "submit" this.onSubmit}}
>
  <div>
    <label>
      Name
      <input
        data-test-user-name-input
        type="text"
        {{on "change" (fn this.setUserField "name")}}
      />
    </label>

    <ErrorMessage
      data-test-user-name-error
      @messages={{this.user.validations.fieldErrors.name}}
    />
  </div>

  <div>
    <label>
      Age
      <input
        type="number"
        {{on "change" (fn this.setUserField "age")}}
      />
    </label>

    <ErrorMessage @messages={{this.user.validations.fieldErrors.age}} />
  </div>
  
  <div>
    <label>
      Is Allergic
      <input
        data-test-user-is-allergic-input
        type="checkbox"
        {{on "change" (fn this.setIsAllergic "isAllergic")}}
      />
    </label>

    <ErrorMessage @messages={{this.user.validations.fieldErrors.isAllergic}} />
  </div>

  <div>
    {{#each this.user.pets as |pet index|}}
      <div data-test-pet={{index}} >
        <label>
          Pet {{index}}
          <input
            data-test-pet-name-input
            type="text"
            {{on "change" (fn this.setPetField pet "name")}}
          /> 
        </label>

        <span>
          <button
            type="button"
            {{on "click" (fn this.removePet pet)}}
          >
            X
          </button>
        </span>
        <ErrorMessage
          data-test-pet-name-error
          @messages={{yup-get
            this.user.validations.fieldErrors
            (concat "pets" "[" index "]" ".name")
          }}
        />
      </div>
    {{/each}}

    <button
      data-test-pet-add
      type="button"
      {{on "click" this.addPet}}
    >
      Add pet
    </button>
  </div>

  <button
    data-test-user-submit
    type="submit"
  >
    Submit
  </button>
</form>
